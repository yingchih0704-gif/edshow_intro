<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>教育策展與實踐：三層次敘事文案練習單</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- jsPDF & html2canvas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=Noto+Serif+TC:wght@700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; }
        h1, h2, h3 { font-family: 'Noto Serif TC', serif; }
        /* 隱藏列印時不必要的元素 */
        @media print {
            .no-print { display: none !important; }
            .print-content { box-shadow: none !important; padding: 0 !important; }
            body { background-color: white; }
        }
    </style>
</head>
<body class="bg-emerald-50 min-h-screen py-8 px-4">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef } = React;

        const CopywritingWorksheet = () => {
            const [formData, setFormData] = useState({
                teamName: '',
                members: '',
                date: new Date().toISOString().split('T')[0],
                
                // 練習題資料
                moving_copy: '',
                moving_visual: '',
                inspiring_copy: '',
                inspiring_visual: '',
                experience_copy: '',
                experience_visual: '',
                
                // 互評資料
                peer_team_name: '',
                peer_moving_score: '0',
                peer_inspiring_score: '0',
                peer_experience_score: '0',
                peer_feedback: ''
            });

            const printRef = useRef(null);
            const [isGenerating, setIsGenerating] = useState(false);

            const handleChange = (e) => {
                const { name, value } = e.target;
                setFormData(prev => ({
                    ...prev,
                    [name]: value
                }));
            };

            const handleDownloadPdf = async () => {
                if (!printRef.current) return;
                setIsGenerating(true);

                try {
                    await new Promise(resolve => setTimeout(resolve, 100));

                    const element = printRef.current;
                    const canvas = await html2canvas(element, {
                        scale: 2,
                        useCORS: true,
                        logging: false,
                        backgroundColor: '#ffffff',
                        windowWidth: element.scrollWidth,
                        windowHeight: element.scrollHeight
                    });

                    const imgData = canvas.toDataURL('image/png');
                    const { jsPDF } = window.jspdf;
                    const pdf = new jsPDF({
                        orientation: 'portrait',
                        unit: 'mm',
                        format: 'a4'
                    });

                    const imgWidth = 210;
                    const pageHeight = 297;
                    const imgHeight = (canvas.height * imgWidth) / canvas.width;
                    let heightLeft = imgHeight;
                    let position = 0;

                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;

                    while (heightLeft >= 0) {
                        position = heightLeft - imgHeight;
                        pdf.addPage();
                        pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                        heightLeft -= pageHeight;
                    }

                    pdf.save(`三層次文案練習單_${formData.teamName || '未命名'}.pdf`);
                } catch (error) {
                    console.error('PDF generation failed', error);
                    alert('PDF 生成失敗，建議使用瀏覽器的「列印 (Ctrl+P) -> 另存為 PDF」功能。');
                } finally {
                    setIsGenerating(false);
                }
            };

            return (
                <div className="font-sans">
                    {/* 控制列 */}
                    <div className="max-w-4xl mx-auto mb-6 flex justify-between items-center bg-white p-4 rounded-lg shadow-sm no-print border border-emerald-100">
                        <h1 className="text-xl font-bold text-emerald-900">教育策展與實踐：三層次敘事文案練習單</h1>
                        <button
                            onClick={handleDownloadPdf}
                            disabled={isGenerating}
                            className={`flex items-center gap-2 bg-emerald-600 text-white px-4 py-2 rounded hover:bg-emerald-700 transition-colors ${isGenerating ? 'opacity-50 cursor-not-allowed' : ''}`}
                        >
                            {isGenerating ? (
                                <span><i className="fas fa-spinner fa-spin"></i> 生成中...</span>
                            ) : (
                                <span><i className="fas fa-file-pdf"></i> 下載 PDF</span>
                            )}
                        </button>
                    </div>

                    {/* 主要工作表區域 */}
                    <div 
                        ref={printRef} 
                        className="print-content max-w-4xl mx-auto bg-white p-8 rounded-lg shadow-lg text-gray-800"
                    >
                        {/* 頁首資訊 */}
                        <div className="border-b-2 border-emerald-100 pb-6 mb-8">
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div className="flex flex-col">
                                    <label className="text-sm font-semibold text-gray-500 mb-1 flex items-center gap-1">
                                        <i className="fas fa-users text-emerald-600"></i> 我方組別
                                    </label>
                                    <input
                                        type="text"
                                        name="teamName"
                                        value={formData.teamName}
                                        onChange={handleChange}
                                        placeholder="輸入組別名稱"
                                        className="border border-gray-300 rounded p-2 focus:ring-2 focus:ring-emerald-200 outline-none"
                                    />
                                </div>
                                <div className="flex flex-col">
                                    <label className="text-sm font-semibold text-gray-500 mb-1">組員姓名</label>
                                    <input
                                        type="text"
                                        name="members"
                                        value={formData.members}
                                        onChange={handleChange}
                                        placeholder="輸入組員姓名"
                                        className="border border-gray-300 rounded p-2 focus:ring-2 focus:ring-emerald-200 outline-none"
                                    />
                                </div>
                                <div className="flex flex-col">
                                    <label className="text-sm font-semibold text-gray-500 mb-1 flex items-center gap-1">
                                        <i className="fas fa-calendar text-emerald-600"></i> 日期
                                    </label>
                                    <input
                                        type="date"
                                        name="date"
                                        value={formData.date}
                                        onChange={handleChange}
                                        className="border border-gray-300 rounded p-2 focus:ring-2 focus:ring-emerald-200 outline-none"
                                    />
                                </div>
                            </div>
                        </div>

                        {/* 練習情境 */}
                        <section className="mb-10 bg-gradient-to-r from-emerald-50 to-teal-50 p-6 rounded-lg border border-emerald-100">
                            <h2 className="text-xl font-bold text-emerald-800 mb-3 flex items-center gap-2">
                                <i className="fas fa-leaf"></i> 策展情境：零碳校園——未來生活實驗室
                            </h2>
                            <p className="text-gray-700 text-sm leading-relaxed mb-4">
                                <strong>目標：</strong> 針對對於「淨零碳排」感到無感的大學生，在校園人流最多的地方（如圖書館大廳）策劃一場微型互動展。<br/>
                                <strong>挑戰：</strong> 如何透過文案，將生硬的環保議題，轉化為大學生願意停下腳步、甚至主動打卡的動力？
                            </p>
                            <div className="flex gap-2 text-xs font-medium">
                                <span className="bg-white text-emerald-600 px-3 py-1 rounded-full border border-emerald-200">#SDGs永續發展</span>
                                <span className="bg-white text-emerald-600 px-3 py-1 rounded-full border border-emerald-200">#校園策展</span>
                                <span className="bg-white text-emerald-600 px-3 py-1 rounded-full border border-emerald-200">#敘事力</span>
                            </div>
                        </section>

                        {/* 第一層：感性層 */}
                        <section className="mb-10">
                            <div className="flex items-center gap-3 mb-4">
                                <div className="w-10 h-10 rounded-full bg-rose-100 text-rose-600 flex items-center justify-center text-xl">
                                    <i className="fas fa-heart"></i>
                                </div>
                                <div>
                                    <h2 className="text-xl font-bold text-gray-800">層次一：感性層 (Moving)</h2>
                                    <span className="text-xs text-gray-500">訴諸情感與價值，喚起共鳴，讓議題與「我」有關。</span>
                                </div>
                            </div>

                            <div className="bg-white border border-gray-200 rounded-lg p-6 shadow-sm mb-4 relative overflow-hidden">
                                <div className="absolute top-0 right-0 bg-rose-50 text-rose-600 text-xs px-3 py-1 rounded-bl-lg font-bold">範例</div>
                                <p className="text-gray-600 italic text-sm">
                                    「冰川融化聽起來很遠，但宿舍昨晚的悶熱卻很近。為了我們未來的每一個夏天，現在就讓地球降溫。」
                                </p>
                            </div>

                            <div className="grid md:grid-cols-3 gap-6">
                                <div className="md:col-span-2">
                                    <label className="block text-sm font-bold text-gray-700 mb-2">
                                        你的文案 (Copy)
                                    </label>
                                    <textarea
                                        name="moving_copy"
                                        value={formData.moving_copy}
                                        onChange={handleChange}
                                        placeholder="試著寫出一段能觸動大學生情感的文字..."
                                        rows="4"
                                        className="w-full border border-gray-300 rounded p-3 text-sm focus:ring-2 focus:ring-rose-200 outline-none resize-none"
                                    ></textarea>
                                </div>
                                <div>
                                    <label className="block text-sm font-bold text-gray-700 mb-2">
                                        視覺搭配 (Visual)
                                    </label>
                                    <textarea
                                        name="moving_visual"
                                        value={formData.moving_visual}
                                        onChange={handleChange}
                                        placeholder="你會搭配什麼樣的照片或插圖？(例如：一張滿頭大汗在宿舍吹電扇的插畫)"
                                        rows="4"
                                        className="w-full border border-gray-300 rounded p-3 text-sm focus:ring-2 focus:ring-rose-200 outline-none resize-none bg-gray-50"
                                    ></textarea>
                                </div>
                            </div>
                        </section>

                        <hr className="border-gray-100 my-8" />

                        {/* 第二層：知識層 */}
                        <section className="mb-10">
                            <div className="flex items-center gap-3 mb-4">
                                <div className="w-10 h-10 rounded-full bg-amber-100 text-amber-600 flex items-center justify-center text-xl">
                                    <i className="fas fa-lightbulb"></i>
                                </div>
                                <div>
                                    <h2 className="text-xl font-bold text-gray-800">層次二：知識層 (Inspiring)</h2>
                                    <span className="text-xs text-gray-500">訴諸好奇與學習，提供冷知識或驚人數據，引發探索慾。</span>
                                </div>
                            </div>

                            <div className="bg-white border border-gray-200 rounded-lg p-6 shadow-sm mb-4 relative overflow-hidden">
                                <div className="absolute top-0 right-0 bg-amber-50 text-amber-600 text-xs px-3 py-1 rounded-bl-lg font-bold">範例</div>
                                <p className="text-gray-600 italic text-sm">
                                    「你知道嗎？寄一封 Email 會產生 4g 的碳排放，這相當於一盞燈泡亮 20 分鐘。快來揪出校園裡的『隱形碳怪獸』！」
                                </p>
                            </div>

                            <div className="grid md:grid-cols-3 gap-6">
                                <div className="md:col-span-2">
                                    <label className="block text-sm font-bold text-gray-700 mb-2">
                                        你的文案 (Copy)
                                    </label>
                                    <textarea
                                        name="inspiring_copy"
                                        value={formData.inspiring_copy}
                                        onChange={handleChange}
                                        placeholder="運用『你知道嗎？』或數據對比，寫出一段引發好奇的文案..."
                                        rows="4"
                                        className="w-full border border-gray-300 rounded p-3 text-sm focus:ring-2 focus:ring-amber-200 outline-none resize-none"
                                    ></textarea>
                                </div>
                                <div>
                                    <label className="block text-sm font-bold text-gray-700 mb-2">
                                        視覺搭配 (Visual)
                                    </label>
                                    <textarea
                                        name="inspiring_visual"
                                        value={formData.inspiring_visual}
                                        onChange={handleChange}
                                        placeholder="你會搭配什麼圖表或視覺符號？(例如：一個怪獸形狀的 Email icon)"
                                        rows="4"
                                        className="w-full border border-gray-300 rounded p-3 text-sm focus:ring-2 focus:ring-amber-200 outline-none resize-none bg-gray-50"
                                    ></textarea>
                                </div>
                            </div>
                        </section>

                        <hr className="border-gray-100 my-8" />

                        {/* 第三層：利益層 */}
                        <section className="mb-10">
                            <div className="flex items-center gap-3 mb-4">
                                <div className="w-10 h-10 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center text-xl">
                                    <i className="fas fa-gift"></i>
                                </div>
                                <div>
                                    <h2 className="text-xl font-bold text-gray-800">層次三：利益層 (Experience)</h2>
                                    <span className="text-xs text-gray-500">訴諸體驗與好處，提供具體誘因，促成行動 (Call to Action)。</span>
                                </div>
                            </div>

                            <div className="bg-white border border-gray-200 rounded-lg p-6 shadow-sm mb-4 relative overflow-hidden">
                                <div className="absolute top-0 right-0 bg-blue-50 text-blue-600 text-xs px-3 py-1 rounded-bl-lg font-bold">範例</div>
                                <p className="text-gray-600 italic text-sm">
                                    「來圖書館吹冷氣，順便拯救地球！現場體驗『人力發電腳踏車』5 分鐘，即刻兌換一張公平貿易咖啡券。流汗，是為了更涼爽的明天。」
                                </p>
                            </div>

                            <div className="grid md:grid-cols-3 gap-6">
                                <div className="md:col-span-2">
                                    <label className="block text-sm font-bold text-gray-700 mb-2">
                                        你的文案 (Copy)
                                    </label>
                                    <textarea
                                        name="experience_copy"
                                        value={formData.experience_copy}
                                        onChange={handleChange}
                                        placeholder="強調參與的好處、贈品或獨特體驗，寫出一段促使行動的文案..."
                                        rows="4"
                                        className="w-full border border-gray-300 rounded p-3 text-sm focus:ring-2 focus:ring-blue-200 outline-none resize-none"
                                    ></textarea>
                                </div>
                                <div>
                                    <label className="block text-sm font-bold text-gray-700 mb-2">
                                        視覺搭配 (Visual)
                                    </label>
                                    <textarea
                                        name="experience_visual"
                                        value={formData.experience_visual}
                                        onChange={handleChange}
                                        placeholder="你會搭配什麼圖片來吸引目光？(例如：一杯看起來很冰涼的咖啡照片)"
                                        rows="4"
                                        className="w-full border border-gray-300 rounded p-3 text-sm focus:ring-2 focus:ring-blue-200 outline-none resize-none bg-gray-50"
                                    ></textarea>
                                </div>
                            </div>
                        </section>

                        {/* 同儕互評區 */}
                        <section className="bg-gray-50 rounded-xl p-6 border border-gray-200 mt-12">
                            <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 pb-4 border-b border-gray-200">
                                <div className="flex items-center gap-2 mb-2 sm:mb-0">
                                    <div className="bg-gray-800 text-white w-8 h-8 rounded-full flex items-center justify-center">
                                        <i className="fas fa-gavel text-sm"></i>
                                    </div>
                                    <h2 className="text-lg font-bold text-gray-800">同儕互評 (Peer Review)</h2>
                                </div>
                                <div className="flex items-center gap-2 w-full sm:w-auto">
                                    <label className="text-sm font-bold text-gray-700 whitespace-nowrap">
                                        受評組別：
                                    </label>
                                    <input
                                        type="text"
                                        name="peer_team_name"
                                        value={formData.peer_team_name}
                                        onChange={handleChange}
                                        placeholder="輸入對方組別名稱"
                                        className="border border-gray-300 rounded p-2 text-sm focus:ring-2 focus:ring-gray-400 outline-none w-full sm:w-48"
                                    />
                                </div>
                            </div>
                            
                            <p className="text-sm text-gray-600 mb-6">請與另一組交換閱讀文案，並針對三個層次給予評分 (1-5分) 與建議。</p>

                            <div className="space-y-6">
                                {[
                                    { label: '感性層 (Moving)：是否有共鳴？是否打動人心？', name: 'peer_moving_score', color: 'rose' },
                                    { label: '知識層 (Inspiring)：是否引發好奇？資訊是否有趣？', name: 'peer_inspiring_score', color: 'amber' },
                                    { label: '利益層 (Experience)：誘因是否足夠吸引人行動？', name: 'peer_experience_score', color: 'blue' }
                                ].map((item, idx) => (
                                    <div key={idx} className="flex flex-col md:flex-row md:items-center justify-between gap-4">
                                        <span className="text-sm font-medium text-gray-700 flex-1">{item.label}</span>
                                        <div className="flex gap-1">
                                            {[1, 2, 3, 4, 5].map((score) => (
                                                <label key={score} className="cursor-pointer">
                                                    <input
                                                        type="radio"
                                                        name={item.name}
                                                        value={score}
                                                        checked={String(formData[item.name]) === String(score)}
                                                        onChange={handleChange}
                                                        className="sr-only peer"
                                                    />
                                                    <div className={`w-8 h-8 rounded-full border border-gray-300 flex items-center justify-center text-sm font-medium text-gray-500 hover:bg-gray-50 transition-all
                                                        peer-checked:bg-${item.color}-500 peer-checked:text-white peer-checked:border-${item.color}-500`}>
                                                        {score}
                                                    </div>
                                                </label>
                                            ))}
                                        </div>
                                    </div>
                                ))}

                                <div className="pt-4 border-t border-gray-200">
                                    <label className="block text-sm font-bold text-gray-700 mb-2">具體建議與回饋：</label>
                                    <textarea
                                        name="peer_feedback"
                                        value={formData.peer_feedback}
                                        onChange={handleChange}
                                        placeholder="哪一句文案寫得最好？哪一部分可以再更有吸引力？"
                                        rows="3"
                                        className="w-full border border-gray-300 rounded p-3 text-sm focus:ring-2 focus:ring-gray-400 outline-none resize-none"
                                    ></textarea>
                                </div>

                                <div className="flex justify-end">
                                    <div className="text-lg font-bold text-gray-800">
                                        總分： 
                                        <span className="text-emerald-600 ml-2 text-2xl">
                                            {Number(formData.peer_moving_score) + Number(formData.peer_inspiring_score) + Number(formData.peer_experience_score)}
                                        </span> 
                                        <span className="text-gray-400 text-sm ml-1">/ 15</span>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <div className="mt-8 text-center text-xs text-gray-400 pt-6">
                            教育策展與實踐課程教材 | 零碳校園專題
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<CopywritingWorksheet />);
    </script>
</body>
</html>